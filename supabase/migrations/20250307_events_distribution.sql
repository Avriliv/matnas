-- Step 1: Enable UUID extension
create extension if not exists "uuid-ossp";

-- Step 2: Drop existing objects
drop trigger if exists on_events_update on public.events;
drop function if exists public.handle_updated_at();
drop index if exists events_date_idx;
drop index if exists events_type_idx;
drop table if exists public.events;

-- Step 3: Create the table
create table public.events (
    id uuid default uuid_generate_v4() primary key,
    title text not null,
    type text not null,
    start_date date not null,
    description text,
    created_at timestamptz default now(),
    updated_at timestamptz default now(),
    budget numeric(10,2) default 0
);

-- Step 4: Create the function for updating timestamps
create function public.handle_updated_at()
returns trigger as $$
begin
    new.updated_at = now();
    return new;
end;
$$ language plpgsql;

-- Step 5: Create the trigger
create trigger on_events_update
    before update on public.events
    for each row
    execute function public.handle_updated_at();

-- Step 6: Create indices
create index events_date_idx on public.events(start_date);
create index events_type_idx on public.events(type);

-- הוספת אירועי מחלקה לשנת תשפ"ה

INSERT INTO events (title, type, start_date, description) VALUES
-- ספטמבר 2024
('כנס חשיפה שנות שירות ומכינות', 'אירוע מועצתי', '2024-09-11', 'כנס חשיפה לשנות שירות ומכינות'),
('ערב פתיחת שנה', 'אירוע', '2024-09-19', 'ערב פתיחת שנת הפעילות'),
('כנס פתיחה לצוותי שנות התבגרות', 'אירוע', '2024-09-24', 'כנס פתיחה לצוותי שנות התבגרות'),
('סמינר פתיחת שנה (כחולים)', 'אירוע', '2024-09-27', 'סמינר פתיחת שנה למדריכים הכחולים'),
('הרמת כוסית חגי תשרי', 'אירוע', '2024-09-30', 'הרמת כוסית לכבוד חגי תשרי'),

-- אוקטובר 2024
('הכנה לחג תנועות הנוער', 'אירוע', '2024-10-08', 'הכנה לקראת חג תנועות הנוער'),
('חג תנועות הנוער', 'אירוע מועצתי', '2024-10-15', 'חג תנועות הנוער המועצתי'),
('טיול סתיו א''-ג''', 'טיול מועצתי', '2024-10-20', 'טיול סתיו לשכבות א''-ג'''),
('סמינר פתיחת שנה - חינוך בעיתות מלחמה', 'אירוע', '2024-10-29', 'סמינר מיוחד בנושא חינוך בעיתות מלחמה'),

-- נובמבר 2024
('סמינר פתיחת שנה (קהילה)', 'אירוע', '2024-11-01', 'סמינר פתיחת שנה למדריכי הקהילה'),
('אירוע לזכר יצחק רבין', 'אירוע מועצתי', '2024-11-12', 'אירוע לציון יום הזיכרון ליצחק רבין'),
('תערוכה ליום הזיכרון הטרנסי', 'אירוע', '2024-11-17', 'תערוכה מיוחדת ליום הזיכרון הטרנסי'),
('הכנת מדריכים - מסע י"ב', 'אירוע', '2024-11-25', 'הכנת מדריכים לקראת מסע י"ב'),

-- דצמבר 2024
('נשף חורף', 'אירוע מועצתי', '2024-12-25', 'נשף חורף מועצתי'),

-- פברואר 2025
('כנס מובילים שנת התבגרות', 'אירוע', '2025-02-07', 'כנס למובילי שנת ההתבגרות'),
('טיול חורף א''-ג''', 'טיול מועצתי', '2025-02-21', 'טיול חורף לשכבות א''-ג'''),
('הכנת מדריכים לכנס י"א', 'אירוע', '2025-02-26', 'הכנת מדריכים לקראת כנס י"א'),

-- מרץ 2025
('טיול נעורים חניתה נמרוד', 'טיול ישובי', '2025-03-06', 'טיול נעורים חניתה נמרוד'),
('הכנת מד"צים למחנה פסח', 'אירוע', '2025-03-07', 'הכנת מדריכים צעירים למחנה פסח'),
('טיול נעורים רגבה נריה', 'טיול ישובי', '2025-03-07', 'טיול נעורים רגבה נריה'),
('כנס י"א', 'אירוע מועצתי', '2025-03-20', 'כנס שכבת י"א'),
('מסע BIG', 'מפעל חיצוני', '2025-03-27', 'מסע BIG'),
('טיול נעורים רגבה נריה', 'טיול ישובי', '2025-03-28', 'טיול נעורים רגבה נריה'),

-- אפריל 2025
('חלוץ מחנה פסח', 'אירוע', '2025-04-06', 'הכנות למחנה פסח'),
('מחנה פסח', 'מפעל חיצוני', '2025-04-07', 'מחנה פסח'),
('מסע נוער אדמית נמרוד', 'טיול ישובי', '2025-04-10', 'מסע נוער אדמית נמרוד'),
('טיול אביב א''-ג''', 'טיול מועצתי', '2025-04-15', 'טיול אביב לשכבות א''-ג'''),

-- מאי 2025
('ימי הבנ"ה', 'אירוע מועצתי', '2025-05-12', 'ימי הבנ"ה'),
('מסע אתגר (כרמל)', 'מפעל חיצוני', '2025-05-15', 'מסע אתגר באזור הכרמל'),
('ערב הוקרה לצוותי חינוך בלתי פורמלי', 'אירוע מועצתי', '2025-05-29', 'ערב הוקרה למדריכים וצוותי החינוך הבלתי פורמלי');
